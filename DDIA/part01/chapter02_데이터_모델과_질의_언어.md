# 02장 데이터 모델과 질의 언어

데이터 모델에는 개발자가 어떻게 문제를 생각하는지가 담겨 있다.

## 관계형 모델과 문서모델
***
데이터는 table로 구성되고, 각 테이블은 순서없는 row의 모음이다.

애플리케이션의 요구사항은 다 다르다. -> 관게형 데이터베이스뿐만 아니라 다양한 비관계형 데이터베이스를 적절히 선택해서 사용해야 한다.
- 다중 저장소 지속성 polyglot persistence

### 객체 관계형 불일치
- 임피던스 불일치 impedance mismatch: OOP과 RDB 사이의 구조적 차이(개념적 차이, 표현 방식 불일치 정도로 해석)
  - ORM으로 해결할 수 있지만 여전히 차이 존재

책에서는 JSON을 언급
- 다중 테이블 스키마보다 더 나은 지역성 -> 질의 용이

### ID를 사용하는 이유
ID에는 의미가 없다 -> 즉, 변경할 필요가 없다는 뜻.
- 정합성에서 장점을 지님.(정규화)

### 네트워크 모델
데이터를 노드와 링크로 구성된 그래프 형태로 표현하는 모델. 레코드에 접근하기 위해서는 최상위 레코드에서부터 연결 경로를 따라 가야 한다.<br>
이것을 접근 경로라 하는데 데이터를 조회할 시 이러한 경로를 전부 추적해야 하기 때문에 매우 불편한 구조였다.
- 포인터로 연결
- 순차적 탐색
- 구조 변경 어려움

### 관계형 모델
데이터를 테이블을 통해 행과 열로 표현한 모델이다. 접근 경로를 옵티마이저가 해주어 용이하다.
- 외래키
- 선언적
- 변경 용이

## 데이터를 위한 질의 언어
***
- 명령형: 특정 순서로 특정 연산을 수행하게끔 컴퓨터에게 지시.
- 선언형: 결과가 충족해야 하는 조건과 데이터를 어떻게 변환할지 지정
  - 이에 대한 방식은 옵티마이저가 수행
  - 데이터베이스 엔진이 캡슐화되어 있어 클라이언트 측에서는 뭐 할 필요가 없음.

## 맵리듀스 질의
***
- MapReduce: 많은 컴퓨터에서 대량의 데이터를 처리하기 위한 프로그래밍 모델.
  1. 입력 데이터를 키-값 쌍으로 분해
  2. 사용자 정의 `map()` 함수로 필요한 중간 결과 생성
  3. 같은 key를 가진 값들 그룹화
  4. `reduce()`로 그룹화된 데이터 집계 처리
  - 여기서 `map`과 `reduce`는 입력으로 전달된 데이터만 사용하고, 부수 효과가 없어야 한다.

## 그래프형 데이터 모델
***
다대다 기능은 데이터 모델 선정에 매우 중요한 점이다. 다대다 관계가 일반적인 사항에서는 그래프로 데이터를 표현하는 것이 자연스럽다.
- 정점, 간선

### 속성 그래프
- 정점 구성
  - 고유 식별자
  - 유출/유입 간선 집합
  - 키-값 쌍
- 간선 구성
  - 고유 식별자
  - 시작/끝 정점
  - 관계 유형 설명 레이블
  - 키-값 쌍
- 장점
  - 유입, 유출 간선 효율적 조회
  - 간선에 다른 유형의 레이블을 여러 개 사용하면 동일 그래프로 다양한 관계가 표현 가능하다.

### 사이퍼 질의 언어
속성 그래프를 위한 선언형 질의 언어로, 네오포제이 그래프 데이터베이스용으로 만들어졌다.
~~~sql
# 정점 선언
(NAmerica:Location  {name:'North America', type:'continent`}),
(USA:Location       {name:'United States', type:'country'}),
(Idaho:Location     {name:'Idaho', type:'state'})

# 간선 선언
(Lucy:Person        {name:'Lucy'}),
(Idaho) -[:WITHIN]-> (USA) -[:WITHIN]-> (NAmerica),
(LUSCY) -[:BORN_IN]-> (Idaho)
~~~

위의 데이터를 통해 아래와 같이 "미국 출생인데 유럽으로 이민 온 사람"을 질의할 수 있다.
~~~sql
MATCH
    (person) -[:BORN_IN]-> () -[:WITHIN*0..]-> (us:Location {name:'United States'}),
    (person) -[:LIVES_IN]-> () -[:WITHIN*0]-> (eu:Location {name:'Europe'})
RETURN person.name
~~~

# 정리
***
데이터 모델은 크게 3가지가 있다. 그리고 중요한 것은 자신의 시스템에 맞는 모델을 택하는 것이다.
- 문서
- 관계형
- 그래프